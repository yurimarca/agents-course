# æ„å»ºå¹¶é›†æˆæ™ºèƒ½ä½“å·¥å…·

èŠ‚å°†ä¸º Alfred èµ‹äºˆç½‘ç»œè®¿é—®èƒ½åŠ›ï¼Œä½¿å…¶èƒ½å¤Ÿè·å–å®æ—¶æ–°é—»ä¸å…¨çƒèµ„è®¯ã€‚
åŒæ—¶è¿˜å°†é›†æˆå¤©æ°”æ•°æ®å’Œ Hugging Face Hub æ¨¡å‹ä¸‹è½½ç»Ÿè®¡åŠŸèƒ½ï¼Œå¸®åŠ©å…¶è¿›è¡Œæ—¶æ•ˆæ€§è¯é¢˜äº¤æµã€‚

## èµ‹äºˆæ™ºèƒ½ä½“ç½‘ç»œè®¿é—®èƒ½åŠ›

è¯·è®°ä½ï¼Œæˆ‘ä»¬å¸Œæœ› Alfred èƒ½å¤Ÿå±•ç°å‡ºä¸€ä½çœŸæ­£çš„æ–‡è‰ºå¤å…´ä¸»æŒäººçš„é£é‡‡ï¼Œå¹¶å¯¹ä¸–ç•Œæœ‰ç€æ·±åˆ»çš„äº†è§£ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ Alfred èƒ½å¤Ÿè·å–æœ‰å…³ä¸–ç•Œçš„æœ€æ–°æ–°é—»å’Œä¿¡æ¯ã€‚

è®©æˆ‘ä»¬ä»ä¸º Alfred åˆ›å»ºä¸€ä¸ªç½‘ç»œæœç´¢å·¥å…·å¼€å§‹å§ï¼

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import DuckDuckGoSearchTool

# åˆå§‹åŒ– DuckDuckGo æœç´¢å·¥å…·
search_tool = DuckDuckGoSearchTool()

# ç¤ºä¾‹ç”¨æ³•
results = search_tool("Who's the current President of France?")
print(results)
```

é¢„æœŸè¾“å‡º:

```
æ³•å›½ç°ä»»æ€»ç»Ÿä¸º Emmanuel Macronã€‚
```


</hfoption>
<hfoption id="llama-index">

```python
from llama_index.tools.duckduckgo import DuckDuckGoSearchToolSpec
from llama_index.core.tools import FunctionTool

# åˆå§‹åŒ– DuckDuckGo æœç´¢å·¥å…·
tool_spec = DuckDuckGoSearchToolSpec()

search_tool = FunctionTool.from_defaults(tool_spec.duckduckgo_full_search)
# ç¤ºä¾‹ç”¨æ³•
response = search_tool("Who's the current President of France?")
print(response.raw_output[-1]['body'])
```

é¢„æœŸè¾“å‡º:

```
æ³•å…°è¥¿å…±å’Œå›½æ€»ç»Ÿæ˜¯æ³•å›½çš„å›½å®¶å…ƒé¦–ã€‚ç°ä»»æ€»ç»Ÿæ˜¯ Emmanuel Macronï¼Œäº2017å¹´5æœˆ14æ—¥å°±ä»»ï¼Œå¹¶åœ¨2017å¹´5æœˆ7æ—¥ä¸¾è¡Œçš„æ€»ç»Ÿé€‰ä¸¾ç¬¬äºŒè½®ä¸­å‡»è´¥ Marine Le Penã€‚æ³•å›½ç¬¬äº”å…±å’Œå›½æ€»ç»Ÿåå• ç¼–å· è‚–åƒ å§“å ...
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain_community.tools import DuckDuckGoSearchRun

search_tool = DuckDuckGoSearchRun()
results = search_tool.invoke("Who's the current President of France?")
print(results)
```

é¢„æœŸè¾“å‡º:

```
Emmanuel Macron ï¼ˆ1977å¹´12æœˆ21æ—¥ç”Ÿäºäºšçœ ï¼‰æ³•å›½æ”¿æ²»å®¶ï¼Œ2017å¹´å½“é€‰æ€»ç»Ÿ...
```

</hfoption>
</hfoptions>

## åˆ›å»ºå¤©æ°”ä¿¡æ¯å·¥å…·ï¼ˆçƒŸèŠ±è°ƒåº¦ï¼‰

å®Œç¾çš„åº†å…¸åº”è¯¥åœ¨æ™´æœ—çš„å¤©ç©ºä¸‹ç‡ƒæ”¾çƒŸèŠ±ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿çƒŸèŠ±ä¸ä¼šå› ä¸ºæ¶åŠ£å¤©æ°”è€Œå–æ¶ˆã€‚

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å·¥å…·ï¼Œç”¨äºè°ƒç”¨å¤–éƒ¨å¤©æ°” API å¹¶è·å–æŒ‡å®šä½ç½®çš„å¤©æ°”ä¿¡æ¯ã€‚

<Tip>
ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åœ¨æœ¬ä¾‹ä¸­ä½¿ç”¨äº†ä¸€ä¸ªè™šæ‹Ÿçš„å¤©æ°” APIã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨çœŸå®çš„å¤©æ°” APIï¼Œæ‚¨å¯ä»¥å®ç°ä¸€ä¸ªä½¿ç”¨ OpenWeatherMap API çš„å¤©æ°”å·¥å…·ï¼Œå°±åƒ<a href="../../unit1/tutorial">Unit 1</a>ä¸­æåˆ°çš„é‚£æ ·ã€‚
</Tip>

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import Tool
import random

class WeatherInfoTool(Tool):
    name = "weather_info"
    description = "Fetches dummy weather information for a given location."
    inputs = {
        "location": {
            "type": "string",
            "description": "The location to get weather information for."
        }
    }
    output_type = "string"

    def forward(self, location: str):
        # è™šæ‹Ÿå¤©æ°”æ•°æ®
        weather_conditions = [
            {"condition": "Rainy", "temp_c": 15},
            {"condition": "Clear", "temp_c": 25},
            {"condition": "Windy", "temp_c": 20}
        ]
        # éšæœºé€‰æ‹©ä¸€ç§å¤©æ°”çŠ¶å†µ
        data = random.choice(weather_conditions)
        return f"Weather in {location}: {data['condition']}, {data['temp_c']}Â°C"

# åˆå§‹åŒ–å·¥å…·
weather_info_tool = WeatherInfoTool()
```

</hfoption>
<hfoption id="llama-index">

```python
import random
from llama_index.core.tools import FunctionTool

def get_weather_info(location: str) -> str:
    """Fetches dummy weather information for a given location."""
    # è™šæ‹Ÿå¤©æ°”æ•°æ®
    weather_conditions = [
        {"condition": "Rainy", "temp_c": 15},
        {"condition": "Clear", "temp_c": 25},
        {"condition": "Windy", "temp_c": 20}
    ]
    # éšæœºé€‰æ‹©ä¸€ç§å¤©æ°”çŠ¶å†µ
    data = random.choice(weather_conditions)
    return f"Weather in {location}: {data['condition']}, {data['temp_c']}Â°C"

# åˆå§‹åŒ–å·¥å…·
weather_info_tool = FunctionTool.from_defaults(get_weather_info)
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain.tools import Tool
import random

def get_weather_info(location: str) -> str:
    """Fetches dummy weather information for a given location."""
    # è™šæ‹Ÿå¤©æ°”æ•°æ®
    weather_conditions = [
        {"condition": "Rainy", "temp_c": 15},
        {"condition": "Clear", "temp_c": 25},
        {"condition": "Windy", "temp_c": 20}
    ]
    # éšæœºé€‰æ‹©ä¸€ç§å¤©æ°”çŠ¶å†µ
    data = random.choice(weather_conditions)
    return f"Weather in {location}: {data['condition']}, {data['temp_c']}Â°C"

# åˆå§‹åŒ–å·¥å…·
weather_info_tool = Tool(
    name="get_weather_info",
    func=get_weather_info,
    description="Fetches dummy weather information for a given location."
)
```

</hfoption>
</hfoptions>

## ä¸ºæœ‰å½±å“åŠ›çš„ AI å¼€å‘è€…åˆ›å»º Hub ç»Ÿè®¡å·¥å…·

å‡ºå¸­æ­¤æ¬¡ç››ä¼šçš„éƒ½æ˜¯ AI å¼€å‘è€…çš„ç²¾è‹±ã€‚Alfred å¸Œæœ›é€šè¿‡è®¨è®ºä»–ä»¬æœ€å—æ¬¢è¿çš„æ¨¡å‹ã€æ•°æ®é›†å’Œç©ºé—´æ¥ç»™ä»–ä»¬ç•™ä¸‹æ·±åˆ»å°è±¡ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå·¥å…·ï¼Œæ ¹æ®ç”¨æˆ·åä» Hugging Face Hub è·å–æ¨¡å‹ç»Ÿè®¡æ•°æ®ã€‚

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import Tool
from huggingface_hub import list_models

class HubStatsTool(Tool):
    name = "hub_stats"
    description = "Fetches the most downloaded model from a specific author on the Hugging Face Hub."
    inputs = {
        "author": {
            "type": "string",
            "description": "The username of the model author/organization to find models from."
        }
    }
    output_type = "string"

    def forward(self, author: str):
        try:
            # åˆ—å‡ºæŒ‡å®šä½œè€…çš„æ¨¡å‹ï¼ŒæŒ‰ä¸‹è½½æ¬¡æ•°æ’åº
            models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))
            
            if models:
                model = models[0]
                return f"The most downloaded model by {author} is {model.id} with {model.downloads:,} downloads."
            else:
                return f"No models found for author {author}."
        except Exception as e:
            return f"Error fetching models for {author}: {str(e)}"

# åˆå§‹åŒ–å·¥å…·
hub_stats_tool = HubStatsTool()

# ç¤ºä¾‹ç”¨æ³•
print(hub_stats_tool("facebook")) # Example: Get the most downloaded model by Facebook
```

é¢„æœŸè¾“å‡º:

```
Facebook ä¸‹è½½æ¬¡æ•°æœ€å¤šçš„æ¨¡å‹æ˜¯ facebook/esmfold_v1ï¼Œä¸‹è½½æ¬¡æ•°ä¸º 12,544,550 æ¬¡ã€‚
```

</hfoption>
<hfoption id="llama-index">

```python
import random
from llama_index.core.tools import FunctionTool
from huggingface_hub import list_models

def get_hub_stats(author: str) -> str:
    """Fetches the most downloaded model from a specific author on the Hugging Face Hub."""
    try:
        # åˆ—å‡ºæŒ‡å®šä½œè€…çš„æ¨¡å‹ï¼ŒæŒ‰ä¸‹è½½æ¬¡æ•°æ’åº
        models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))

        if models:
            model = models[0]
            return f"The most downloaded model by {author} is {model.id} with {model.downloads:,} downloads."
        else:
            return f"No models found for author {author}."
    except Exception as e:
        return f"Error fetching models for {author}: {str(e)}"

# åˆå§‹åŒ–å·¥å…·
hub_stats_tool = FunctionTool.from_defaults(get_hub_stats)

# ç¤ºä¾‹ç”¨æ³•
print(hub_stats_tool("facebook")) # Example: Get the most downloaded model by Facebook
```

é¢„æœŸè¾“å‡º:

```
Facebook ä¸‹è½½æ¬¡æ•°æœ€å¤šçš„æ¨¡å‹æ˜¯ facebook/esmfold_v1ï¼Œä¸‹è½½æ¬¡æ•°ä¸º 12,544,550 æ¬¡ã€‚
```

</hfoption>
<hfoption id="langgraph">

```python
from langchain.tools import Tool
from huggingface_hub import list_models

def get_hub_stats(author: str) -> str:
    """Fetches the most downloaded model from a specific author on the Hugging Face Hub."""
    try:
        # åˆ—å‡ºæŒ‡å®šä½œè€…çš„æ¨¡å‹ï¼ŒæŒ‰ä¸‹è½½æ¬¡æ•°æ’åº
        models = list(list_models(author=author, sort="downloads", direction=-1, limit=1))

        if models:
            model = models[0]
            return f"The most downloaded model by {author} is {model.id} with {model.downloads:,} downloads."
        else:
            return f"No models found for author {author}."
    except Exception as e:
        return f"Error fetching models for {author}: {str(e)}"

# åˆå§‹åŒ–å·¥å…·
hub_stats_tool = Tool(
    name="get_hub_stats",
    func=get_hub_stats,
    description="Fetches the most downloaded model from a specific author on the Hugging Face Hub."
)

# ç¤ºä¾‹ç”¨æ³•
print(hub_stats_tool("facebook")) # Example: Get the most downloaded model by Facebook
```

é¢„æœŸè¾“å‡º:

```
Facebook ä¸‹è½½æ¬¡æ•°æœ€å¤šçš„æ¨¡å‹æ˜¯ facebook/esmfold_v1ï¼Œä¸‹è½½æ¬¡æ•°ä¸º 13,109,861 æ¬¡ã€‚
```

</hfoption>
</hfoptions>

å€ŸåŠ© Hub Stats å·¥å…·ï¼ŒAlfred ç°åœ¨å¯ä»¥é€šè¿‡è®¨è®ºä»–ä»¬æœ€å—æ¬¢è¿çš„æ¨¡å‹æ¥æ‰“åŠ¨æœ‰å½±å“åŠ›çš„ AI å¼€å‘è€…ã€‚

## å°†å·¥å…·ä¸ Alfred é›†æˆ

ç°åœ¨æˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†æ‰€æœ‰å·¥å…·ï¼Œè®©æˆ‘ä»¬å°†å®ƒä»¬é›†æˆåˆ° Alfred çš„æ™ºèƒ½ä½“ä¸­ï¼š

<hfoptions id="agents-frameworks">
<hfoption id="smolagents">

```python
from smolagents import CodeAgent, HfApiModel

# åˆå§‹åŒ– Hugging Face æ¨¡å‹
model = HfApiModel()

# ä½¿ç”¨æ‰€æœ‰å·¥å…·åˆ›å»º Alfred
alfred = CodeAgent(
    tools=[search_tool, weather_info_tool, hub_stats_tool], 
    model=model
)

# Alfred åœ¨åº†å…¸æœŸé—´å¯èƒ½ä¼šæ”¶åˆ°çš„ç¤ºä¾‹æŸ¥è¯¢
response = alfred.run("What is Facebook and what's their most popular model?")

print("ğŸ© Alfred's Response:")
print(response)
```

é¢„æœŸè¾“å‡º: 

```
ğŸ© Alfred's Response:
Facebook æ˜¯ä¸€ä¸ªç¤¾äº¤ç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œäº’ç›¸è”ç³»ã€åˆ†äº«ä¿¡æ¯å¹¶äº’åŠ¨ã€‚Facebook åœ¨ Hugging Face Hub ä¸Šä¸‹è½½æ¬¡æ•°æœ€å¤šçš„æ¨¡å‹æ˜¯ ESMFold_v1ã€‚
```

</hfoption>
<hfoption id="llama-index">

```python
from llama_index.core.agent.workflow import AgentWorkflow
from llama_index.llms.huggingface_api import HuggingFaceInferenceAPI

# åˆå§‹åŒ– Hugging Face æ¨¡å‹
llm = HuggingFaceInferenceAPI(model_name="Qwen/Qwen2.5-Coder-32B-Instruct")
# ä½¿ç”¨æ‰€æœ‰å·¥å…·åˆ›å»º Alfred
alfred = AgentWorkflow.from_tools_or_functions(
    [search_tool, weather_info_tool, hub_stats_tool],
    llm=llm
)

# Alfred åœ¨åº†å…¸æœŸé—´å¯èƒ½ä¼šæ”¶åˆ°çš„ç¤ºä¾‹æŸ¥è¯¢
response = await alfred.run("What is Facebook and what's their most popular model?")

print("ğŸ© Alfred's Response:")
print(response)
```

é¢„æœŸè¾“å‡º: 

```
ğŸ© Alfred's Response:
Facebook æ˜¯ä¸€å®¶æ€»éƒ¨ä½äºåŠ åˆ©ç¦å°¼äºšå·é—¨æ´›å¸•å…‹çš„ç¤¾äº¤ç½‘ç»œæœåŠ¡å’Œç§‘æŠ€å…¬å¸ã€‚å®ƒç”±é©¬å…‹Â·æ‰å…‹ä¼¯æ ¼åˆ›ç«‹ï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºä¸ªäººèµ„æ–™ã€ä¸äº²æœ‹å¥½å‹è”ç³»ã€åˆ†äº«ç…§ç‰‡å’Œè§†é¢‘ï¼Œä»¥åŠåŠ å…¥åŸºäºå…±åŒå…´è¶£çš„ç¾¤ç»„ã€‚Facebook åœ¨ Hugging Face Hub ä¸Šæœ€å—æ¬¢è¿çš„æ¨¡å‹æ˜¯â€œfacebook/esmfold_v1â€ï¼Œä¸‹è½½é‡è¾¾ 13,109,861 æ¬¡ã€‚
```

</hfoption>
<hfoption id="langgraph">

```python
from typing import TypedDict, Annotated
from langgraph.graph.message import add_messages
from langchain_core.messages import AnyMessage, HumanMessage, AIMessage
from langgraph.prebuilt import ToolNode
from langgraph.graph import START, StateGraph
from langgraph.prebuilt import tools_condition
from langchain_huggingface import HuggingFaceEndpoint, ChatHuggingFace

# ç”ŸæˆèŠå¤©ç•Œé¢ï¼ŒåŒ…æ‹¬å·¥å…·
llm = HuggingFaceEndpoint(
    repo_id="Qwen/Qwen2.5-Coder-32B-Instruct",
    huggingfacehub_api_token=HUGGINGFACEHUB_API_TOKEN,
)

chat = ChatHuggingFace(llm=llm, verbose=True)
tools = [search_tool, weather_info_tool, hub_stats_tool]
chat_with_tools = chat.bind_tools(tools)

# ç”Ÿæˆ AgentState å’Œ Agent å›¾
class AgentState(TypedDict):
    messages: Annotated[list[AnyMessage], add_messages]

def assistant(state: AgentState):
    return {
        "messages": [chat_with_tools.invoke(state["messages"])],
    }

## æ„å»ºæµç¨‹å›¾
builder = StateGraph(AgentState)

# å®šä¹‰èŠ‚ç‚¹ï¼šè¿™äº›èŠ‚ç‚¹å®Œæˆå·¥ä½œ
builder.add_node("assistant", assistant)
builder.add_node("tools", ToolNode(tools))

# å®šä¹‰è¾¹ï¼šè¿™äº›å†³å®šäº†æ§åˆ¶æµå¦‚ä½•ç§»åŠ¨
builder.add_edge(START, "assistant")
builder.add_conditional_edges(
    "assistant",
    # If the latest message requires a tool, route to tools
    # Otherwise, provide a direct response
    tools_condition,
)
builder.add_edge("tools", "assistant")
alfred = builder.compile()

messages = [HumanMessage(content="Who is Facebook and what's their most popular model?")]
response = alfred.invoke({"messages": messages})

print("ğŸ© Alfred's Response:")
print(response['messages'][-1].content)
```

é¢„æœŸè¾“å‡º:

```
ğŸ© Alfred's Response:
Facebook æ˜¯ä¸€å®¶ç¤¾äº¤åª’ä½“å…¬å¸ï¼Œä»¥å…¶ç¤¾äº¤ç½‘ç«™ Facebook ä»¥åŠ Instagram å’Œ WhatsApp ç­‰å…¶ä»–æœåŠ¡è€Œé—»åã€‚Facebook åœ¨ Hugging Face Hub ä¸Šä¸‹è½½æ¬¡æ•°æœ€å¤šçš„æ¨¡å‹æ˜¯ facebook/esmfold_v1ï¼Œä¸‹è½½é‡è¾¾ 13,202,321 æ¬¡ã€‚
```
</hfoption>
</hfoptions>

## ç»“è®º

é€šè¿‡é›†æˆè¿™äº›å·¥å…·ï¼ŒAlfred ç°åœ¨å¯ä»¥å¤„ç†å„ç§ä»»åŠ¡ï¼Œä»ç½‘é¡µæœç´¢åˆ°å¤©æ°”æ›´æ–°å’Œæ¨¡å‹ç»Ÿè®¡ã€‚è¿™ç¡®ä¿ä»–å§‹ç»ˆæ˜¯æ™šä¼šä¸Šæœ€äº†è§£æƒ…å†µã€æœ€æœ‰é­…åŠ›çš„ä¸»æŒäººã€‚

<Tip>
å°è¯•å®ç°ä¸€ä¸ªå¯ç”¨äºè·å–ç‰¹å®šä¸»é¢˜æœ€æ–°æ¶ˆæ¯çš„å·¥å…·ã€‚

å®Œæˆåï¼Œåœ¨ <code>tools.py</code> æ–‡ä»¶ä¸­å®ç°æ‚¨çš„è‡ªå®šä¹‰å·¥å…·ã€‚
</Tip>
